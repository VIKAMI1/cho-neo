(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{681:(e,t,n)=>{Promise.resolve().then(n.bind(n,852))},852:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var s=n(6223),r=n(3287),a=n(9119),i=n.n(a),l=n(2715);let c={tien:"Tiền",tiem:"Tiệm",tinh:"T\xecnh",banthan:"Bản th\xe2n"},m="xinXam.topicLock.v1";function x(){var e,t,n;let a="http://localhost:8788",[x,h]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1),[u,b]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null);async function N(e){if(!a)throw Error("Missing NEXT_PUBLIC_OD_BASE");let t=function(){try{var e,t,n;let s="od_vid",r=localStorage.getItem(s);if(r)return r;let a=null!=(n=null==(t=globalThis.crypto)||null==(e=t.randomUUID)?void 0:e.call(t))?n:"vid_".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2));return localStorage.setItem(s,a),a}catch(e){return"dev"}}(),n="".concat(a).concat(e,"?visitor_id=").concat(encodeURIComponent(t)),s=await fetch(n,{method:"POST",headers:{"content-type":"application/json"},cache:"no-store"});if(!s.ok){let e=await s.text().catch(()=>"");throw Error("Xin Xăm API failed ".concat(s.status,": ").concat(e))}return await s.json()}(0,r.useEffect)(()=>{try{let e=localStorage.getItem(m);if(!e)return;let t=JSON.parse(e);(null==t?void 0:t.topic)&&h(t.topic)}catch(e){}},[]);let y=async()=>{if(x){d(!0),j(null),g(!0);try{let e=await N("/xin-xam/draw");b(e);try{localStorage.setItem(m,JSON.stringify({week:e.week,topic:x}))}catch(e){}}catch(t){var e;j(null!=(e=null==t?void 0:t.message)?e:"Xin Xăm bị nghẽn."),b(null)}finally{g(!1)}}},v=async()=>{j(null),g(!0);try{let e=await N("/xin-xam/refresh");b(e)}catch(t){var e;j(null!=(e=null==t?void 0:t.message)?e:"Xin Xăm bị nghẽn.")}finally{g(!1)}},w=p||(null!=(n=null==u?void 0:u.refresh_remaining)?n:1)===0;(0,r.useEffect)(()=>{if(null==u?void 0:u.week)try{let e=localStorage.getItem(m);if(!e)return;let t=JSON.parse(e);(null==t?void 0:t.week)&&t.week!==u.week&&localStorage.removeItem(m)}catch(e){}},[null==u?void 0:u.week]);let k=(0,r.useMemo)(()=>x?(0,s.jsxs)("p",{className:"mt-2 text-xs text-amber-800/90",children:["Tuần n\xe0y xin xăm về"," ",(0,s.jsx)("span",{className:"font-semibold",children:c[x]}),". Đừng \xf4m th\xeam chuyện kh\xe1c v\xf4 chung."]}):null,[x]);return(0,s.jsx)("div",{className:"min-h-screen bg-[#FFF9F0]",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)(i(),{href:"/",className:"text-sm text-amber-800 hover:text-amber-900 underline-offset-2 hover:underline",children:"← Về Chợ Neo"}),(0,s.jsx)("span",{className:"text-xs uppercase tracking-wide text-amber-700",children:"Xin xăm tuần n\xe0y"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"shrink-0",children:(0,s.jsx)(l.default,{src:"/Xin-Xam.png",alt:"Xin Xăm tuần n\xe0y",width:80,height:80,className:"h-20 w-20 object-contain"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-amber-950",children:"Xin Xăm tuần n\xe0y"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-amber-800",children:"Kh\xf4ng phải b\xf3i cho vui. Chỉ l\xe0 ngồi lại một ch\xfat cho l\xf2ng bớt rối, rồi mới t\xednh đường đi tiếp."})]})]}),(0,s.jsxs)("section",{className:"rounded-2xl border border-amber-100 bg-amber-50/60 p-4 space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold text-amber-900",children:"Trước khi xin xăm"}),(0,s.jsx)("p",{className:"text-sm text-amber-900",children:"H\xedt thở chậm một nhịp. Nghĩ r\xf5 trong đầu:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-sm text-amber-900 space-y-1",children:[(0,s.jsx)("li",{children:"Một chuyện muốn hỏi, kh\xf4ng phải mười chuyện."}),(0,s.jsx)("li",{children:"M\xecnh muốn nghe sự thật nhẹ nh\xe0ng, kh\xf4ng phải lời khen cho sướng."}),(0,s.jsx)("li",{children:"Xin xăm để r\xf5 đường, kh\xf4ng phải để trốn tr\xe1ch nhiệm."})]}),(0,s.jsx)("p",{className:"text-xs text-amber-800/80",children:"Khi l\xf2ng bớt gấp, xăm mới n\xf3i tr\xfang."})]}),(0,s.jsxs)("section",{className:"rounded-2xl border border-amber-100 bg-white p-4 space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold text-amber-900",children:"Chọn chủ đề \xd4ng Địa nhắc"}),(0,s.jsxs)("p",{className:"text-xs text-amber-800/80",children:["Chỉ chọn ",(0,s.jsx)("span",{className:"font-semibold",children:"một"})," chủ đề cho tuần n\xe0y. Tuần sau t\xednh chuyện kh\xe1c."]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:Object.keys(c).map(e=>{let t=x===e;return(0,s.jsx)("button",{type:"button",onClick:()=>{h(e),d(!1),b(null),j(null)},className:["px-3 py-1.5 rounded-full border text-sm transition focus:outline-none focus:ring-2 focus:ring-amber-500/60",t?"bg-amber-900 text-amber-50 border-amber-900 shadow-sm":"bg-amber-50 text-amber-900 border-amber-200 hover:bg-amber-100"].join(" "),children:c[e]},e)})}),k]}),(0,s.jsxs)("section",{className:"rounded-2xl border border-amber-100 bg-amber-900 text-amber-50 p-4 space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold",children:"\xd4ng Địa nhắc nhẹ"}),(0,s.jsx)("p",{className:"text-sm",children:"Xin xăm tuần n\xe0y th\xf4i nha. Đừng xin tới xin lui mỗi lần thấy bất an. Nghe xăm xong rồi th\xec chịu kh\xf3 l\xe0m phần của m\xecnh nữa."}),(0,s.jsx)("p",{className:"text-xs text-amber-100/80",children:"Nếu cảm thấy kh\xf4ng nghe nổi sự thật, cứ để tuần sau rồi xin. Kh\xf4ng sao hết."}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[(0,s.jsx)("p",{className:"text-xs text-amber-100/90",children:"Khi sẵn s\xe0ng, bấm n\xfat. Một tuần xin một lần l\xe0 đủ."}),(0,s.jsx)("button",{type:"button",onClick:()=>void y(),disabled:!x||p,className:["px-4 py-2 rounded-full text-sm font-medium transition",!x||p?"bg-amber-700/60 text-amber-100 cursor-not-allowed":"bg-amber-50 text-amber-900 hover:bg-white shadow-sm"].join(" "),children:x?"Đ\xe3 hiểu, cho em xin xăm":"Chọn chủ đề trước nha"})]}),f&&(0,s.jsxs)("div",{className:"text-xs text-amber-100/90",children:["Lỗi: ",f]})]}),o&&(0,s.jsxs)("section",{className:"rounded-2xl border border-amber-100 bg-white p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-amber-700",children:"Quẻ tuần n\xe0y"}),p&&(0,s.jsx)("div",{className:"text-sm text-amber-900",children:"Đang xin quẻ…"}),!p&&u&&(0,s.jsx)("h2",{className:"text-sm font-semibold text-amber-950",children:u.stick.title})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(null==u?void 0:u.week)&&(0,s.jsxs)("span",{className:"inline-flex items-center rounded-full border border-amber-200 bg-amber-50 px-2.5 py-1 text-[11px] font-medium text-amber-900",children:["Tuần ",u.week]}),(null==u||null==(e=u.stick)?void 0:e.luck)&&(0,s.jsx)("span",{className:"inline-flex items-center rounded-full border px-2.5 py-1 text-[11px] font-medium ".concat(function(e){switch(e){case"DAI_CAT":return"bg-emerald-50 text-emerald-900 border-emerald-200";case"CAT":return"bg-green-50 text-green-900 border-green-200";case"BINH":return"bg-zinc-50 text-zinc-800 border-zinc-200";case"HUNG":return"bg-rose-50 text-rose-900 border-rose-200"}}(u.stick.luck)),children:function(e){switch(e){case"DAI_CAT":return"Đại C\xe1t";case"CAT":return"C\xe1t";case"BINH":return"B\xecnh";case"HUNG":return"Hung"}}(u.stick.luck)}),(null==u||null==(t=u.stick)?void 0:t.no)&&(0,s.jsxs)("span",{className:"inline-flex items-center rounded-full border border-zinc-200 bg-white px-2.5 py-1 text-[11px] font-medium text-zinc-700",children:["Số ",u.stick.no]}),x&&(0,s.jsxs)("span",{className:"inline-flex items-center rounded-full border border-amber-200 bg-amber-50 px-2.5 py-1 text-[11px] font-medium text-amber-900",children:["Chủ đề: ",c[x]]})]})]}),!p&&u&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2 text-sm text-amber-900",children:[(0,s.jsx)("p",{className:"italic whitespace-pre-line",children:u.stick.poem}),(0,s.jsx)("p",{children:u.stick.meaning})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap pt-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>void v(),disabled:w,className:["px-3 py-2 rounded-xl text-xs border border-zinc-200 bg-white hover:bg-zinc-50",w?"opacity-50 cursor-not-allowed":""].join(" "),children:"Đổi quẻ (1 lần)"}),(0,s.jsx)("div",{className:"text-[11px] text-zinc-500",children:0===u.refresh_remaining?"Tuần n\xe0y hết đổi.":"C\xf2n 1 lần đổi tuần n\xe0y."})]}),u.message&&(0,s.jsx)("div",{className:"text-xs text-amber-800/90",children:u.message}),(0,s.jsx)("p",{className:"text-[11px] text-amber-700/80",children:"Xăm chỉ nhắc đường. C\xf2n đi đường n\xe0o, quay lại l\xfac n\xe0o – l\xe0 quyền của m\xecnh."})]}),!p&&!u&&(0,s.jsx)("div",{className:"text-sm text-amber-900",children:"Chưa xin được quẻ. Thử bấm lại."})]})]})})}}},e=>{e.O(0,[119,715,483,933,358],()=>e(e.s=681)),_N_E=e.O()}]);