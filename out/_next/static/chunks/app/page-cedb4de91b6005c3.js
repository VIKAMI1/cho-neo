(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{982:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var n=s(6223),i=s(3287),a=s(7620);function l(){let e=(0,i.useMemo)(()=>(0,a.UU)("https://xqabvmiljboliyzxczkw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxYWJ2bWlsamJvbGl5enhjemt3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjI1OTksImV4cCI6MjA3OTkzODU5OX0.LAZTX2bgdEpqOXOKu1lSzjnWRxvakBeOrJeUFV8M-s0"),[]),[t,s]=(0,i.useState)([]),[l,r]=(0,i.useState)(null);async function c(){let{data:t,error:n}=await e.from("showoff_feed").select("*").order("created_at",{ascending:!1}).limit(30);if(n)throw n;s(null!=t?t:[])}async function o(t,s){r(null);try{let{data:n}=await e.auth.getUser();if(!n.user)throw Error("Sign in to react.");let i=n.user.id;if((await e.from("showoff_reactions").insert([{post_id:t,user_id:i,emoji:s}])).error){let n=await e.from("showoff_reactions").delete().eq("post_id",t).eq("user_id",i).eq("emoji",s);if(n.error)throw n.error}await c()}catch(e){var n;r(null!=(n=null==e?void 0:e.message)?n:"Reaction failed.")}}return(0,i.useEffect)(()=>{c().catch(e=>{var t;return r(null!=(t=null==e?void 0:e.message)?t:"Failed to load.")})},[]),(0,n.jsxs)("div",{className:"mx-auto max-w-3xl p-4",children:[(0,n.jsxs)("div",{className:"mb-4 flex items-end justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Show-Off"}),(0,n.jsx)("p",{className:"text-sm opacity-80",children:"Reactions only. Keep it clean."})]}),(0,n.jsx)("a",{className:"rounded-xl border px-4 py-2 text-sm shadow-sm",href:"/show-off/new",children:"New Post"})]}),l&&(0,n.jsx)("div",{className:"mb-4 rounded-xl border border-red-300 bg-red-50 p-3 text-sm",children:l}),(0,n.jsx)("div",{className:"space-y-4",children:0===t.length?(0,n.jsx)("div",{className:"rounded-2xl border p-6 text-sm opacity-80",children:"No Show-Off posts yet."}):t.map(e=>{var t,s,i,a;return(0,n.jsxs)("div",{className:"rounded-2xl border p-4 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"text-xs opacity-70",children:new Date(e.created_at).toLocaleString()}),(0,n.jsxs)("div",{className:"text-xs opacity-70",children:["expires ",new Date(e.expires_at).toLocaleDateString()]})]}),(null==(t=e.media)?void 0:t.length)>0&&(0,n.jsx)("div",{className:"mt-3 grid grid-cols-3 gap-2",children:e.media.slice(0,3).map(e=>(0,n.jsx)("div",{className:"relative aspect-square overflow-hidden rounded-xl border",children:(0,n.jsx)("img",{src:e.url,alt:"showoff",className:"h-full w-full object-cover"})},e.id))}),e.caption&&(0,n.jsx)("div",{className:"mt-3 text-sm",children:e.caption}),(0,n.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-sm",children:[(0,n.jsxs)("button",{onClick:()=>o(e.id,"\uD83D\uDD25"),className:"rounded-xl border px-3 py-1",children:["\uD83D\uDD25 ",null!=(s=e.fire_count)?s:0]}),(0,n.jsxs)("button",{onClick:()=>o(e.id,"\uD83D\uDC85"),className:"rounded-xl border px-3 py-1",children:["\uD83D\uDC85 ",null!=(i=e.nail_count)?i:0]}),(0,n.jsxs)("button",{onClick:()=>o(e.id,"\uD83D\uDC40"),className:"rounded-xl border px-3 py-1",children:["\uD83D\uDC40 ",null!=(a=e.eyes_count)?a:0]})]})]},e.id)})})]})}},2023:(e,t,s)=>{"use strict";s.d(t,{U:()=>i});var n=s(7620);function i(){return(0,n.UU)("https://xqabvmiljboliyzxczkw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxYWJ2bWlsamJvbGl5enhjemt3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjI1OTksImV4cCI6MjA3OTkzODU5OX0.LAZTX2bgdEpqOXOKu1lSzjnWRxvakBeOrJeUFV8M-s0")}},2245:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var n,i,a=s(6223),l=s(3287),r=s(9119),c=s.n(r),o=s(2715),d=s(2023);function x(e){var t;let{className:s=""}=e,[n,i]=(0,l.useState)(!1),[r,c]=(0,l.useState)(!1),[o,d]=(0,l.useState)(null),[x,u]=(0,l.useState)(null),h=(0,l.useMemo)(()=>"http://localhost:8788",[]);async function m(e){if(!h)throw Error("Missing NEXT_PUBLIC_OD_BASE");let t=function(){try{var e,t,s;let n=localStorage.getItem("od_vid");if(n)return n;let i=null!=(s=null==(t=globalThis.crypto)||null==(e=t.randomUUID)?void 0:e.call(t))?s:"vid_".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2));return localStorage.setItem("od_vid",i),i}catch(e){return"dev"}}(),s="".concat(h).concat(e,"?visitor_id=").concat(encodeURIComponent(t)),n=await fetch(s,{method:"POST",headers:{"content-type":"application/json"},cache:"no-store"});if(!n.ok){let e=await n.text().catch(()=>"");throw Error("Xin Xăm API failed ".concat(n.status,": ").concat(e))}return await n.json()}async function p(){i(!0),d(null),c(!0);try{let e=await m("/xin-xam/draw");u(e)}catch(t){var e;d(null!=(e=null==t?void 0:t.message)?e:"Xin Xăm bị nghẽn."),u(null)}finally{c(!1)}}async function g(){d(null),c(!0);try{let e=await m("/xin-xam/refresh");u(e)}catch(t){var e;d(null!=(e=null==t?void 0:t.message)?e:"Xin Xăm bị nghẽn.")}finally{c(!1)}}let f=r||(null!=(t=null==x?void 0:x.refresh_remaining)?t:1)===0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>void p(),className:"inline-flex items-center justify-center rounded-full border border-amber-200 bg-amber-50 px-3 py-1.5 text-xs font-medium text-amber-900 hover:bg-amber-100 ".concat(s),children:"Xin xăm tuần n\xe0y"}),n&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:()=>i(!1)}),(0,a.jsxs)("div",{className:"relative w-full md:max-w-lg rounded-t-2xl md:rounded-2xl bg-[#fbf7ef] border border-zinc-200 shadow-xl p-4 md:p-5",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-wide text-zinc-600 font-semibold",children:"Xin Xăm"}),(0,a.jsx)("div",{className:"text-sm text-zinc-600",children:"Mỗi tuần 1 quẻ. (Bạn c\xf3 tối đa 1 lần đổi/tuần.)"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("a",{href:"/xin-xam",className:"text-xs px-3 py-2 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50",children:"Mở trang"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"text-xs px-3 py-2 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50",children:"Đ\xf3ng"})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[r&&(0,a.jsx)("div",{className:"text-sm text-zinc-600",children:"Đang xin quẻ…"}),!r&&o&&(0,a.jsx)("div",{className:"text-sm text-rose-700",children:o}),!r&&!o&&x&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full border border-zinc-200 bg-white text-zinc-700",children:["Tuần ",x.week]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full border ".concat(function(e){switch(e){case"DAI_CAT":return"bg-emerald-50 text-emerald-900 border-emerald-200";case"CAT":return"bg-green-50 text-green-900 border-green-200";case"BINH":return"bg-zinc-50 text-zinc-800 border-zinc-200";case"HUNG":return"bg-rose-50 text-rose-900 border-rose-200"}}(x.stick.luck)),children:function(e){switch(e){case"DAI_CAT":return"Đại C\xe1t";case"CAT":return"C\xe1t";case"BINH":return"B\xecnh";case"HUNG":return"Hung"}}(x.stick.luck)}),(0,a.jsxs)("span",{className:"text-xs text-zinc-500",children:["Số ",x.stick.no]})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,a.jsx)("div",{className:"text-base font-semibold text-zinc-900",children:x.stick.title}),(0,a.jsx)("div",{className:"mt-2 text-sm text-zinc-800 whitespace-pre-line",children:x.stick.poem}),(0,a.jsx)("div",{className:"mt-3 text-sm text-zinc-700",children:x.stick.meaning})]}),x.message&&(0,a.jsx)("div",{className:"text-xs text-zinc-600",children:x.message}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("button",{onClick:()=>void g(),disabled:f,className:"text-xs px-3 py-2 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 ".concat(f?"opacity-50 cursor-not-allowed":""),children:"Đổi quẻ (1 lần)"}),(0,a.jsx)("div",{className:"text-[11px] text-zinc-500",children:0===x.refresh_remaining?"Tuần n\xe0y hết đổi.":"C\xf2n 1 lần đổi tuần n\xe0y."})]})]}),!r&&!o&&!x&&(0,a.jsx)("div",{className:"text-sm text-zinc-600",children:"Bấm “Xin xăm tuần n\xe0y” để xin quẻ."})]})]})]})]})}var u=s(982),h=s(7084);let m=null!=(n=h.env.NEXT_PUBLIC_API_BASE)?n:"http://localhost:8000",p=null!=(i=h.env.NEXT_PUBLIC_API_KEY)?i:"dev-123",g=new Set(["image/jpeg","image/png","image/webp"]),f=(0,d.U)();function b(e){return e.length<=28?e:e.slice(0,18)+"…"+e.slice(-8)}function v(){let[e,t]=(0,l.useState)(""),[s,n]=(0,l.useState)([]),[i,r]=(0,l.useState)(!1),[c,o]=(0,l.useState)(""),d=(0,l.useMemo)(()=>!i&&s.length>0&&s.length<=4,[i,s]);function x(e){o(t=>t?t+"\n"+e:e)}async function u(e){let t=await fetch("".concat(m,"/api/uploads/presign"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":p},body:JSON.stringify({filename:e.name,content_type:e.type,bytes:e.size})});if(!t.ok){let e=await t.text();throw Error("presign failed (".concat(t.status,"): ").concat(e))}return await t.json()}async function h(e,t){let s=await fetch(e,{method:"PUT",headers:{"Content-Type":t.type},body:t});if(!s.ok){let e=await s.text();throw Error("PUT upload failed (".concat(s.status,"): ").concat(e))}}async function v(e,t){let s=await fetch("".concat(m,"/api/uploads/commit"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":p},body:JSON.stringify({post_id:e,raw_key:t})});if(!s.ok){let e=await s.text();throw Error("commit failed (".concat(s.status,"): ").concat(e))}return await s.json()}async function j(){var t,n,i,a,l;let c="post_".concat(Date.now());r(!0),o("");try{let l;x("\uD83E\uDDFE Post: pending…"),x("\uD83D\uDDBC️ Uploading ".concat(s.length," image(s)…"));let r=[];for(let e=0;e<s.length;e++){let t=s[e];x("→ [".concat(e+1,"/").concat(s.length,"] Presign ").concat(b(t.name)));let n=await u(t);x("→ [".concat(e+1,"/").concat(s.length,"] PUT upload")),await h(n.upload_url,t),x("→ [".concat(e+1,"/").concat(s.length,"] Commit"));let i=await v(c,n.raw_key),a={...i,raw_key:n.raw_key};r.push(a),x("✅ Stored: ".concat(i.url_thumb))}x(""),x("\uD83C\uDF89 Done. Next: save post record with these URLs:");let{data:o}=await f.auth.getUser(),d=null==o?void 0:o.user;if(!d)throw Error("Not signed in");r.map(e=>e.url_original),r.map(e=>e.url_thumb);try{let{data:t,error:s}=await f.from("showoff_posts").insert({caption:(null==e?void 0:e.trim())||"(no caption)",user_id:d.id}).select("id").single();if(s)throw s;l=t.id}catch(a){if(!String(null!=(i=null==a?void 0:a.message)?i:"").includes("showoff_posts_one_per_day"))throw a;x("\uD83E\uDDF7 Today’s post already exists — adding photos to it...");let{data:t,error:s}=await f.from("showoff_posts").select("id").eq("user_id",d.id).order("created_at",{ascending:!1}).limit(1).single();if(s)throw s;l=t.id;let{error:n}=await f.from("showoff_posts").update({caption:(null==e?void 0:e.trim())||"(no caption)"}).eq("id",l);if(n)throw n}let{data:m,error:p}=await f.from("showoff_media").select("sort_order").eq("post_id",l).order("sort_order",{ascending:!1}).limit(1);if(p)throw p;let g=null!=(a=null==m||null==(t=m[0])?void 0:t.sort_order)?a:-1,j=r.map((e,t)=>({post_id:l,storage_key:e.raw_key,url:e.url_original,width:e.width,height:e.height,sort_order:g+t+1}));console.log("postId",l),console.log("mediaRows",j);let{data:w,error:N}=await f.from("showoff_media").insert(j).select("id, post_id, sort_order, storage_key");if(N)throw console.error("showoff_media insert failed:",N),x("\uD83D\uDD25 media insert failed: ".concat(N.message)),N;console.log("inserted showoff_media",w),x("✅ showoff_media inserted");let{data:y,error:_}=await f.from("showoff_posts").select("\n    id,\n    created_at,\n    caption,\n    user_id,\n    showoff_media (\n      id,\n      storage_key,\n      url,\n      width,\n      height,\n      sort_order\n    )\n  ").eq("id",l).single();if(_)throw _;return null==(n=y.showoff_media)||n.sort((e,t)=>{var s,n;return(null!=(s=e.sort_order)?s:0)-(null!=(n=t.sort_order)?n:0)}),x("✅ Saved. Updating feed..."),y}catch(e){x("\uD83D\uDD25 ".concat(null!=(l=null==e?void 0:e.message)?l:String(e)))}finally{r(!1)}}return(0,a.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-6 space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Show Off"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Caption"}),(0,a.jsx)("textarea",{className:"w-full rounded-lg border border-black/10 p-3 outline-none",rows:3,placeholder:"What did you create today?",value:e,onChange:e=>t(e.target.value),disabled:i})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium",children:["Photos (max ",4,")"]}),(0,a.jsx)("input",{type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,onChange:function(e){var t;let i=Array.from(null!=(t=e.target.files)?t:[]);e.target.value="";let a=[];for(let e of i){if(!g.has(e.type)){x("❌ ".concat(e.name,": unsupported type (").concat(e.type||"unknown",")"));continue}if(e.size>5242880){x("❌ ".concat(e.name,": too large (").concat(Math.round(e.size/1024/1024),"MB)"));continue}a.push(e)}let l=[...s,...a].slice(0,4);l.length<s.length+a.length&&x("⚠️ Max ".concat(4," images. Extra files ignored.")),n(l)},disabled:i||s.length>=4}),s.length>0&&(0,a.jsx)("ul",{className:"text-sm space-y-1",children:s.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("span",{children:b(e.name)}),(0,a.jsx)("button",{className:"text-xs underline opacity-70 hover:opacity-100",onClick:()=>n(e=>e.filter((e,s)=>s!==t)),disabled:i,children:"remove"})]},t))})]}),(0,a.jsx)("button",{className:"w-full rounded-lg bg-black text-white py-3 disabled:opacity-50",disabled:!d,onClick:j,children:i?"Uploading…":"Upload Photos"}),c&&(0,a.jsx)("pre",{className:"whitespace-pre-wrap rounded-lg bg-black/5 p-3 text-xs leading-5 overflow-auto",children:c}),(0,a.jsxs)("p",{className:"text-xs opacity-70",children:[(0,a.jsx)("span",{className:"font-medium",children:"Rules:"})," 1 Show-Off post per day (you can add photos to today’s post anytime)."," ",(0,a.jsx)("span",{className:"font-medium",children:"Limits:"})," Up to 4 photos per post • No duplicate photos • JPG/PNG/WEBP only • Max 5MB each • EXIF removed on upload."," ",(0,a.jsx)("span",{className:"font-medium",children:"Note:"})," Reactions only. Keep it clean."]})]})}let j=(0,d.U)(),w={vent:{title:"G\xf3c Xả Hơi",subtitle:"Xả nhẹ cho đỡ nặng l\xf2ng. Kh\xf4ng t\xean thật, kh\xf4ng số phone, kh\xf4ng địa chỉ.",placeholder:"N\xf3i một c\xe2u cho nhẹ người…"},brag:{title:"Show Off",subtitle:"Khoe bộ m\xf3ng, g\xf3c tiệm, đồ nghề. Khoe để vui, kh\xf4ng khoe để hơn thua.",placeholder:"H\xf4m nay muốn khoe g\xec n\xe8…"}},N={chill:"Chợ kh\xe1 chill",warning:"Chợ hơi căng",hustle:"Chợ m\xe1u lửa"},y={chill:"bg-emerald-50 text-emerald-800 border-emerald-200",warning:"bg-amber-50 text-amber-900 border-amber-200",hustle:"bg-orange-50 text-orange-900 border-orange-200"};function _(e){return e?"".concat(e.slice(0,6),"…"):"ẩn danh…"}function z(e){let t=new Date(e);return Number.isNaN(t.getTime())?"":"".concat(t.toISOString().slice(0,16).replace("T"," ")," UTC")}function k(){var e,t,s;let[n,i]=(0,l.useState)(null),[r,d]=(0,l.useState)(null),[h,m]=(0,l.useState)("vent"),[p,g]=(0,l.useState)([]),[f,b]=(0,l.useState)(""),[k,S]=(0,l.useState)(null),[C,I]=(0,l.useState)(!0),[E,D]=(0,l.useState)(null),[U,O]=(0,l.useState)({}),[T,q]=(0,l.useState)(null),[X,P]=(0,l.useState)(""),[B,J]=(0,l.useState)(null),M=!!n,A="choNeo.wish.v1",[R,L]=(0,l.useState)(""),[G,F]=(0,l.useState)(null);(0,l.useEffect)(()=>{try{let e=localStorage.getItem(A);if(!e)return;let t=JSON.parse(e);(null==t?void 0:t.wishBlessed)&&F(t.wishBlessed)}catch(e){}},[]),(0,l.useEffect)(()=>{try{localStorage.setItem(A,JSON.stringify({wishBlessed:G}))}catch(e){}},[G]);let H=(0,l.useMemo)(()=>{var e,t=null==k||null==(e=k.quote)?void 0:e.tag;let s=(null!=t?t:"").toLowerCase();return s.includes("hustle")?"hustle":s.includes("boundary")||s.includes("drama")||s.includes("warning")?"warning":"chill"},[k]),K=(0,l.useMemo)(()=>k?N[H]:"Chợ đang coi quẻ",[k,H]),V=(0,l.useMemo)(()=>k?y[H]:"bg-zinc-50 text-zinc-700 border-zinc-200",[k,H]);async function W(e){let{data:t,error:s}=await j.from("posts").select("id, body, created_at, space, user_id, hidden").eq("space",e).eq("hidden",!1).order("created_at",{ascending:!1});if(s)return void console.error("Error loading posts:",s);g(null!=t?t:[])}async function Z(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];I(!0),D(null);try{let t="http://localhost:8788";if(!t)throw Error("Missing NEXT_PUBLIC_OD_BASE");let s=function(){try{var e,t,s;let n=localStorage.getItem("od_vid");if(n)return n;let i=null!=(s=null==(t=globalThis.crypto)||null==(e=t.randomUUID)?void 0:e.call(t))?s:"vid_".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2));return localStorage.setItem("od_vid",i),i}catch(e){return"dev"}}(),n="".concat(t).concat(e?"/od/refresh":"/od/today","?visitor_id=").concat(encodeURIComponent(s)),i=await fetch(n,{method:e?"POST":"GET",headers:{"content-type":"application/json"},cache:"no-store"});if(!i.ok){let e=await i.text().catch(()=>"");throw Error("\xd4ng Địa API failed ".concat(i.status,": ").concat(e))}let a=await i.json();S(null!=a?a:null)}catch(e){var t;console.log("\xd4ng Địa strip load issue:",e),S(null),D(null!=(t=null==e?void 0:e.message)?t:"\xd4ng Địa bị nghẽn.")}finally{I(!1)}}async function Y(e){J(e);try{let{data:t,error:s}=await j.from("post_replies").select("id, post_id, body, created_at, user_id, hidden").eq("post_id",e).eq("hidden",!1).order("created_at",{ascending:!0});if(s)return void console.error("Error loading replies:",s);O(s=>({...s,[e]:null!=t?t:[]}))}finally{J(null)}}(0,l.useEffect)(()=>{let e=!0;!async function(){let{data:t,error:s}=await j.auth.getUser();if(e){if(s||!t.user)i(null),d(null);else{var n;i(null!=(n=t.user.email)?n:null),d(t.user.id)}await Z(!1),await W(h)}}();let{data:t}=j.auth.onAuthStateChange((t,s)=>{var n,a,l,r;e&&(i(null!=(l=null==s||null==(n=s.user)?void 0:n.email)?l:null),d(null!=(r=null==s||null==(a=s.user)?void 0:a.id)?r:null),W(h))}),s=j.channel("live:posts").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},t=>{if(!e)return;let s=t.new;(null==s?void 0:s.space)&&s.space===h&&(s.hidden||g(e=>[s,...e]))}).subscribe();return()=>{e=!1,null==t||t.subscription.unsubscribe(),j.removeChannel(s)}},[h]);let Q=async()=>{await j.auth.signOut(),i(null),d(null),g([]),O({}),q(null)},$=async()=>{let e=f.trim();if(!e)return;let{data:t,error:s}=await j.auth.getUser();if(s||!t.user)return;let{error:n}=await j.from("posts").insert({body:e,space:h,user_id:t.user.id});if(n)return void console.error("Error inserting post:",n);b("")},ee=async()=>W(h),et=async e=>{if(T===e){q(null),P("");return}q(e),P(""),U[e]||await Y(e)},es=async e=>{let t=X.trim();if(!t)return;let{data:s,error:n}=await j.auth.getUser();if(n||!s.user)return;let{data:i,error:a}=await j.from("post_replies").insert({post_id:e,body:t,user_id:s.user.id}).select("*").single();if(a)return void console.error("Error inserting reply:",a);P(""),O(t=>{var s;return{...t,[e]:[...null!=(s=t[e])?s:[],i]}})},en=async e=>{let{error:t}=await j.from("posts").update({hidden:!0}).eq("id",e.id).eq("user_id",e.user_id);if(t)return void console.error("Error hiding post:",t);g(t=>t.filter(t=>t.id!==e.id)),O(t=>{let s={...t};return delete s[e.id],s}),T===e.id&&q(null)},ei=async e=>{let{error:t}=await j.from("post_replies").update({hidden:!0}).eq("id",e.id).eq("user_id",e.user_id);if(t)return void console.error("Error hiding reply:",t);O(t=>{var s;let n=null!=(s=t[e.post_id])?s:[];return{...t,[e.post_id]:n.filter(t=>t.id!==e.id)}})},ea=C||(null!=(t=null==k?void 0:k.refresh_remaining)?t:1)===0;return(0,a.jsxs)("main",{className:"min-h-screen bg-[#fbf7ef] text-zinc-900",children:[(0,a.jsx)("div",{className:"pointer-events-none fixed inset-0 opacity-[0.035] bg-[radial-gradient(#000_1px,transparent_1px)] [background-size:18px_18px]"}),(0,a.jsxs)("div",{className:"relative mx-auto max-w-3xl px-4 py-8 md:py-10 space-y-6",children:[(0,a.jsxs)("header",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"Chợ Neo"}),(0,a.jsx)("span",{className:"text-[11px] px-2 py-1 rounded-full border border-zinc-200 bg-white/70 text-zinc-700",children:"beta nội bộ"})]}),(0,a.jsx)("p",{className:"text-sm text-zinc-600",children:"Chợ nhỏ cho xả hơi & show off nhẹ — kiểu người Việt m\xecnh."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[M&&(0,a.jsx)(c(),{className:"underline text-zinc-700",href:"/profile",children:"Profile"}),M?(0,a.jsx)("button",{className:"underline text-zinc-700",onClick:Q,children:"Sign out"}):(0,a.jsx)(c(),{className:"underline text-zinc-700",href:"/login",children:"Sign in"})]})]}),(0,a.jsxs)("section",{className:"rounded-2xl border border-zinc-200 bg-white/80 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 md:p-5 flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 rounded-2xl bg-amber-100 border border-amber-200 flex items-center justify-center overflow-hidden",children:(0,a.jsx)(o.default,{src:"/ong-dia.png",alt:"\xd4ng Địa",width:48,height:48,className:"h-full w-full object-cover"})}),(0,a.jsxs)("div",{className:"min-w-0 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"\xd4ng Địa n\xf3i g\xec h\xf4m nay"}),(0,a.jsx)("span",{className:"text-[11px] px-2 py-1 rounded-full border ".concat(V),children:K})]}),C?(0,a.jsx)("p",{className:"text-sm text-zinc-500",children:"Đang coi quẻ…"}):k?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-base font-semibold leading-snug",children:null!=(s=null==(e=k.quote)?void 0:e.text)?s:"…"}),(0,a.jsx)("div",{className:"text-[11px] text-zinc-500",children:0===k.refresh_remaining?"H\xf4m nay hết refresh.":"Bạn c\xf2n 1 refresh h\xf4m nay."}),k.message&&(0,a.jsx)("div",{className:"text-xs text-zinc-600",children:k.message}),(0,a.jsx)("p",{className:"text-[11px] text-zinc-500",children:"Gợi \xfd cảm x\xfac th\xf4i nha. Kh\xf4ng thay b\xe1c sĩ, luật sư, hay quyết định của bạn."})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-zinc-600",children:"H\xf4m nay chưa c\xf3 quẻ. R\xe1ng thở s\xe2u, uống nước v\xe0 tự chọn vibe cho m\xecnh."}),E&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:E})]}),(0,a.jsxs)("div",{className:"pt-3",children:[(0,a.jsxs)("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-zinc-600",children:["Xin \xd4ng Địa ban lộc",G?" ✨":""]}),G?(0,a.jsxs)("div",{className:"mt-2 rounded-xl border border-zinc-200 bg-[#fffdf8] p-3",children:[(0,a.jsxs)("div",{className:"text-sm text-zinc-800",children:["“",G,"”"]}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{F(null);try{localStorage.removeItem(A)}catch(e){}},className:"text-xs px-3 py-2 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800",children:"Đ\xe3 nhận – cho tan đi"}),(0,a.jsx)("button",{onClick:()=>F(null),className:"text-xs px-3 py-2 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50",children:"Đổi \xfd"})]}),(0,a.jsx)("div",{className:"mt-2 text-[11px] text-zinc-500",children:"Bấm “Đ\xe3 nhận” để kết lời xin. \xd4ng Địa nghe rồi đ\xf3 — quẻ kh\xe9p lại."})]}):(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)("input",{value:R,onChange:e=>L(e.target.value),placeholder:"V\xe1i \xd4ng Địa: cho con xin một điều…",className:"flex-1 rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-200"}),(0,a.jsx)("button",{onClick:()=>{let e=R.trim();e&&(F(e),L(""))},className:"text-xs px-3 py-2 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800",children:"Xin"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex md:flex-col gap-2 md:items-end",children:[(0,a.jsx)(x,{className:"text-[12px]"}),(0,a.jsx)("button",{onClick:()=>void Z(!0),disabled:ea,className:"text-[12px] px-3 py-2 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 ".concat(ea?"opacity-50 cursor-not-allowed":""),children:"Refresh quẻ"})]})]}),(0,a.jsx)("div",{className:"px-4 md:px-5 py-3 border-t border-zinc-200 bg-gradient-to-r from-emerald-50/70 via-amber-50/70 to-orange-50/70",children:(0,a.jsxs)("p",{className:"text-xs text-zinc-700",children:["Luật chợ: ",(0,a.jsx)("span",{className:"font-semibold",children:"kh\xf4ng doxx"})," • kh\xf4ng số phone • kh\xf4ng địa chỉ • kh\xf4ng k\xe9o hội đồng."]})})]}),(0,a.jsxs)("section",{className:"rounded-2xl border border-zinc-200 bg-white/80 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 md:px-5 pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[["vent","brag"].map(e=>(0,a.jsx)("button",{onClick:()=>m(e),className:"px-4 py-2 rounded-xl text-sm border transition ".concat(h===e?"bg-zinc-900 text-white border-zinc-900":"bg-white border-zinc-200 text-zinc-700 hover:bg-zinc-50"),children:w[e].title},e)),(0,a.jsx)("div",{className:"ml-auto flex items-center gap-3",children:(0,a.jsx)("button",{className:"text-sm underline text-zinc-600 hover:text-zinc-900",onClick:ee,children:"Refresh"})})]}),(0,a.jsx)("p",{className:"mt-3 text-sm text-zinc-600",children:w[h].subtitle})]}),(0,a.jsx)("div",{className:"px-4 md:px-5 py-4",children:M?"brag"===h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-xs opacity-70",children:"Tip: khoe để vui. 1–3 ảnh, gọn, sạch."}),(0,a.jsxs)("div",{className:"space-y-4 mt-3",children:[(0,a.jsx)(v,{}),(0,a.jsx)(u.A,{})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-xs opacity-70",children:"Tip: viết như n\xf3i chuyện ngo\xe0i tiệm. Ngắn, thật, kh\xf4ng \xe1c."}),(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-[#fffdf8] p-3 md:p-4 mt-3",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"flex-1 rounded-xl border border-zinc-200 bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-amber-200",placeholder:w[h].placeholder,value:f,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&$()}),(0,a.jsx)("button",{className:"rounded-xl px-4 py-3 text-sm font-semibold bg-zinc-900 text-white hover:bg-zinc-800",onClick:$,children:"Post"})]})})]}):(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-[#fffdf8] p-4 text-sm text-zinc-700",children:["Bạn cần"," ",(0,a.jsx)(c(),{className:"underline font-semibold",href:"/login",children:"Sign in"})," ","để đăng b\xe0i v\xe0 trả lời."]})}),(0,a.jsxs)("div",{className:"px-4 md:px-5 pb-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h2",{className:"text-base font-bold",children:[w[h].title," — latest"]}),(0,a.jsxs)("span",{className:"text-xs text-zinc-500",children:[p.length," b\xe0i"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[0===p.length&&(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-5 text-sm text-zinc-600",children:"Chưa c\xf3 ai n\xf3i g\xec ở đ\xe2y. Bạn mở h\xe0ng một c\xe2u đi."}),p.map(e=>{var t;let s=null!=(t=U[e.id])?t:[],n=T===e.id;return(0,a.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsx)("div",{className:"min-w-0",children:(0,a.jsxs)("div",{className:"text-xs text-zinc-500",children:[z(e.created_at)," — by ",_(e.user_id)]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3 shrink-0",children:[(0,a.jsx)("button",{className:"text-xs underline text-zinc-600 hover:text-zinc-900",onClick:()=>et(e.id),children:n?"Ẩn trả lời":"Trả lời (".concat(s.length,")")}),e.user_id===r&&(0,a.jsx)("button",{className:"text-xs underline text-zinc-400 hover:text-zinc-700",onClick:()=>en(e),children:"Hide"})]})]}),(0,a.jsx)("div",{className:"mt-2 text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.body}),n&&(0,a.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-200 bg-[#fffdf8] p-3",children:[B===e.id&&(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Đang tải trả lời…"}),0===s.length&&B!==e.id&&(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Chưa ai trả lời b\xe0i n\xe0y."}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-white p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"text-xs text-zinc-500",children:[z(e.created_at)," — by ",_(e.user_id)]}),e.user_id===r&&(0,a.jsx)("button",{className:"text-xs underline text-zinc-400 hover:text-zinc-700",onClick:()=>ei(e),children:"Hide"})]}),(0,a.jsx)("div",{className:"mt-1 text-sm whitespace-pre-wrap break-words",children:e.body})]},e.id))}),M&&(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("input",{className:"flex-1 rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-200",placeholder:"Trả lời nhẹ nh\xe0ng…",value:X,onChange:e=>P(e.target.value),onKeyDown:t=>"Enter"===t.key&&es(e.id)}),(0,a.jsx)("button",{className:"rounded-xl px-4 py-2 text-sm font-semibold bg-zinc-900 text-white hover:bg-zinc-800",onClick:()=>es(e.id),children:"Gửi"})]})]})]},e.id)})]})]})]}),(0,a.jsx)("footer",{className:"text-xs text-zinc-500 pt-2",children:"Powered by hustle, grit, and just a touch of GPT."})]})]})}},5426:(e,t,s)=>{Promise.resolve().then(s.bind(s,2245))}},e=>{e.O(0,[620,119,715,483,933,358],()=>e(e.s=5426)),_N_E=e.O()}]);